# Parallel Scanning Proof of Concept (PoC)

**Version:** v3.4 Phase 0
**Script:** `scripts/poc_parallel_scan.py`
**Status:** Ready to execute

## Overview

This PoC validates the parallel scanning approach for v3.4 by testing with the real vscan.dev API. It discovers rate limits, validates SQLite thread safety, and measures actual performance gains before we implement production code.

## Objectives

1. **Discover Rate Limits** - Find the maximum safe worker count before vscan.dev rate limits us
2. **Validate Thread Safety** - Ensure SQLite cache handles concurrent access without corruption
3. **Measure Performance** - Quantify actual speedup gains with different worker counts
4. **Make Go/No-Go Decision** - Determine if we should proceed to Phase 1 implementation

## Test Matrix

The PoC runs 8 test scenarios:

| Test | Workers | Cache State | Purpose |
|------|---------|-------------|---------|
| 1    | 1       | Empty       | Baseline - sequential scan, no cache |
| 2    | 1       | 50/50 mix   | Baseline with cache benefit |
| 3    | 3       | Empty       | **Target config** - our planned production default |
| 4    | 3       | 50/50 mix   | Target with realistic cache usage |
| 5    | 5       | Empty       | Higher load test |
| 6    | 5       | 50/50 mix   | Higher load with cache |
| 7    | 7       | Empty       | Stress test to find rate limit threshold |
| 8    | 7       | 50/50 mix   | Stress test with cache |

**Test Dataset:** 30 popular VS Code extensions (Microsoft, community, language support, etc.)

## Success Criteria

For a **GO** decision to proceed to Phase 1, all criteria must be met:

- âœ… **No Rate Limit Errors** - Zero HTTP 429 responses with 3 workers
- âœ… **SQLite Thread Safety** - No database locking errors during concurrent access
- âœ… **Performance Target** - Speedup â‰¥ 2.5x with 3 workers (empty cache)
- âœ… **Stats Accuracy** - Thread-safe stats collection (no race conditions)
- âœ… **Error Handling** - Worker failures captured and reported correctly
- âœ… **Data Integrity** - No cache corruption (passes SQLite integrity check)

## Running the PoC

### Prerequisites

- Python 3.8+
- Internet connection (will make real API calls to vscan.dev)
- ~30-60 minutes of execution time
- ~200-300 API requests will be made (respects rate limits)

### Execution

```bash
# From project root
python3 scripts/poc_parallel_scan.py

# Or make it executable and run directly
chmod +x scripts/poc_parallel_scan.py
./scripts/poc_parallel_scan.py
```

### What to Expect

**Console Output:**
```
============================================================
VS Code Extension Scanner - Parallel Scanning PoC
============================================================
Test dataset: 30 extensions
Test scenarios: 8
PoC cache directory: ~/.vscan-poc

============================================================
Test 1/8: 1 worker(s), empty cache
============================================================
  Starting scan with 1 worker(s)...
    [1/30] ms-python.python                     ðŸ” âœ“
    [2/30] ms-vscode.cpptools                   ðŸ” âœ“
    ...
  Completed in 62.3s
  âœ“ Cache integrity check passed

[... more tests ...]

TEST RESULTS SUMMARY
============================================================
Test   Workers  Cache    Cached   Fresh    Duration     ...
1      1        empty    0        30       62.3s        ...
2      1        50/50    15       15       31.5s        ...
3      3        empty    0        30       22.1s        ...
...
============================================================
```

**Duration:**
- **Optimistic:** 20-30 minutes (if vscan.dev is fast and no errors)
- **Realistic:** 30-45 minutes (typical API response times)
- **Pessimistic:** 45-60 minutes (slow API, retries needed)

**Output Files:**
- **Report:** `docs/research/parallel-scan-poc-results.md`
- **PoC Cache:** `~/.vscan-poc/cache.db` (separate from production cache)

## Expected Results

### If GO Decision âœ“

```markdown
## Go/No-Go Decision

### Success Criteria
- âœ“ No rate limit errors with 3 workers
- âœ“ No SQLite locking errors
- âœ“ Speedup target met: 2.8x >= 2.5x
- âœ“ High success rate: 95.0%

### **Decision: GO âœ“**

All success criteria met. Proceed to Phase 1 (production implementation).

**Recommended worker count for production:** 3 workers
```

**Next Steps:**
1. Review detailed results in `docs/research/parallel-scan-poc-results.md`
2. Update `docs/project/v3.4-ROADMAP.md` with PoC findings
3. Proceed to Phase 1: Production implementation

### If NO-GO Decision âœ—

```markdown
## Go/No-Go Decision

### Success Criteria
- âœ— Rate limit errors with 3 workers: 5
- âœ“ No SQLite locking errors
- âœ— Speedup below target: 1.8x < 2.5x

### **Decision: NO-GO âœ—**

One or more success criteria failed. Do not proceed to Phase 1.

**Required actions:**
- Address: Rate limit errors with 3 workers
- Address: Speedup below target
```

**Next Steps:**
1. Analyze failure reasons in `docs/research/parallel-scan-poc-results.md`
2. Consider alternatives:
   - Reduce worker count to 2
   - Increase delays between requests
   - Implement more sophisticated rate limiting
   - Abandon parallel scanning for v3.4
3. Update v3.4-ROADMAP.md with decision and rationale

## Understanding the Results

### Key Metrics

**Speedup Factor:**
- Calculated as: `baseline_duration / test_duration`
- Example: Test 1 took 60s, Test 3 took 20s â†’ Speedup = 3.0x
- Target: â‰¥ 2.5x for 3 workers

**Cache Hit Rate:**
- Percentage of extensions served from cache (instant) vs API calls
- Empty cache tests: 0% (all fresh scans)
- 50/50 mix tests: ~50% (15 cached, 15 fresh)

**Error Types:**
- **Rate Limit (429):** vscan.dev is throttling us - too many concurrent requests
- **Timeout:** Request took longer than timeout limit
- **Server Error (5xx):** vscan.dev API issues
- **SQLite Error:** Database locking or corruption issues
- **Other:** Network errors, malformed responses, etc.

### Performance Analysis

**Ideal Speedup:** With 3 workers, ideal speedup = 3.0x
**Realistic Speedup:** 2.5-2.8x (accounting for coordination overhead, API latency variance)
**Below Target:** < 2.0x suggests issues (rate limiting, high overhead, slow API)

## Troubleshooting

### Issue: Rate Limit Errors (429)

**Symptoms:** HTTP 429 responses in error breakdown

**Causes:**
- Too many concurrent workers
- vscan.dev API has stricter limits than expected

**Actions:**
- If errors with 3 workers: Reduce to 2 workers in Phase 1
- If errors with 5+ workers only: Safe to use 3 workers
- Consider increasing delays between requests

### Issue: Low Speedup (< 2.0x)

**Symptoms:** Speedup factor well below target

**Causes:**
- vscan.dev API has high latency variance
- Thread coordination overhead too high
- Request delays too conservative

**Actions:**
- Analyze per-extension timing variance
- Consider if 2.0x speedup is still worth the complexity
- May need to abandon parallel scanning approach

### Issue: SQLite Locking Errors

**Symptoms:** sqlite_error count > 0

**Causes:**
- SQLite not handling concurrent writes properly
- Cache manager not thread-safe as expected

**Actions:**
- Review cache_manager.py implementation
- May need to implement connection pooling
- Consider write serialization (defeats purpose of parallel)

## Cleanup

After PoC completion, you can remove the PoC cache:

```bash
rm -rf ~/.vscan-poc
```

Production cache at `~/.vscan/` is not affected by this PoC.

## References

- **v3.4 Roadmap:** `docs/project/v3.4-ROADMAP.md`
- **Architecture:** `docs/guides/ARCHITECTURE.md`
- **Security:** `docs/guides/SECURITY.md`
- **API Reference:** `docs/guides/API_REFERENCE.md`

---

**Questions?** Review the v3.4-ROADMAP.md Phase 0 section for detailed specifications.
