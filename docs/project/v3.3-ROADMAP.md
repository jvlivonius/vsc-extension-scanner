# V3.3 UX Enhancement & Performance Plan
**Date:** 2025-10-25
**Current Version:** 3.2.0
**Target Version:** 3.3.0
**Focus Areas:** User Experience, Error Transparency, Optional Performance

---

## Executive Summary

This document outlines the v3.3 release plan for the VS Code Extension Scanner. Version 3.3 focuses on **improving user experience through cleaner output, better error reporting, and optional performance enhancements** while maintaining full backward compatibility.

**Status:** Planning for v3.3.0 release

**Key Goals:**
1. **Security-Focused Output** - Hide operational details by default, show security findings prominently
2. **Failed Extension Transparency** - Clearly report which extensions failed to scan and why
3. **Configuration Flexibility** - Support custom extension directory in config file
4. **Optional Parallel Scanning** - Speed up large scans with 2-3 concurrent workers (opt-in)

**Guiding Principles:**
- **Rich/Plain Compatibility** - Every feature must work perfectly in both Rich and plain output modes
- **KISS Architecture** - No over-engineering, simple and maintainable solutions
- **Backward Compatible** - All new features are opt-in or enhancement-only
- **Fail Fast with Helpful Guidance** - Better error messages with actionable suggestions

---

## Feature Specifications

### Feature 1: Extension Directory in Config File

**Priority:** HIGH (Foundation)
**Complexity:** LOW
**Estimated Effort:** 2-3 hours

**Problem:**
Users with custom VS Code installations or multiple extension directories must specify `--extensions-dir` on every scan. This is tedious and error-prone.

**Solution:**
Add `extensions_dir` option to `[scan]` section in `~/.vscanrc` config file.

**Configuration Example:**
```ini
[scan]
# Custom VS Code extensions directory (optional)
# extensions_dir = ~/.vscode/extensions  # Default
extensions_dir = ~/custom/vscode/extensions
```

**Implementation Details:**
- **Type:** `path` (supports ~ expansion)
- **Validation:** Lazy (validate on scan, not on config set) - allows setting paths that don't exist yet
- **Priority:** CLI argument > config file > auto-detect
- **Config Schema:** Add to `CONFIG_SCHEMA` and `DEFAULT_CONFIG` in `config_manager.py`

**Files Modified:**
1. `vscode_scanner/config_manager.py`:
   - Add `extensions_dir` to `CONFIG_SCHEMA['scan']`
   - Add to `DEFAULT_CONFIG['scan']` with `None` default
   - Add to `DEFAULT_CONFIG_TEMPLATE` with commented example

2. `vscode_scanner/cli.py`:
   - Load `extensions_dir` from config if not specified via CLI
   - Apply same precedence as other config options

**Rich/Plain Compatibility:**
- Config display commands (`vscan config show`) already support both modes
- No special display logic needed (path is plain text)

**Testing:**
- Set and get `extensions_dir` via config commands
- Verify CLI argument overrides config value
- Verify auto-detect works when config is `None`
- Test path expansion (~ to home directory)

**Success Criteria:**
- ‚úÖ Can set custom directory in config file
- ‚úÖ CLI argument takes precedence over config
- ‚úÖ Auto-detect still works when not configured
- ‚úÖ Path validation only happens during scan

---

### Feature 2: Enhanced Verbose Mode

**Priority:** HIGH (Foundation)
**Complexity:** MEDIUM
**Estimated Effort:** 4-6 hours

**Problem:**
Standard output mixes security findings with operational details (retry stats, cache info, timing). Users focused on security must wade through technical information.

**Solution:**
Create three distinct output modes:
1. **Quiet Mode** (`--quiet`) - Single-line summary only (existing)
2. **Standard Mode** (default, NEW) - Security findings only, hide operational details
3. **Verbose Mode** (`--verbose`) - Security + operational details (enhanced)

**Standard Mode Output (NEW):**
```
Scanning 66 extensions...
[=========>          ] 25/66

‚úì Scan Complete

Security Summary:
‚Ä¢ Total extensions: 66
‚Ä¢ Vulnerabilities found: 3 (4.5%)
  - High risk: 2
  - Medium risk: 1

Report saved: report.html
```

**Verbose Mode Output (Enhanced):**
```
Scanning 66 extensions...
[=========>          ] 25/66 (‚ö° 18 cached, üîç 7 fresh)

Cache Statistics:
‚Ä¢ Hit rate: 72%
‚Ä¢ Cached: 48, Fresh: 18
‚Ä¢ Age distribution: ...

Retry Statistics:
‚Ä¢ Total retries: 12
‚Ä¢ Successful: 11
‚Ä¢ Failed: 1

‚úì Scan Complete (took 45.2s, avg 0.68s/ext)

Security Summary:
‚Ä¢ Total extensions: 66
‚Ä¢ Vulnerabilities found: 3 (4.5%)
  - High risk: 2
  - Medium risk: 1

Report saved: report.html
```

**What Gets Hidden in Standard Mode:**
- ‚ùå Per-extension cache symbols (‚ö°/üîç)
- ‚ùå Cache statistics (hit rate, age distribution, risk breakdown)
- ‚ùå Retry statistics (HTTP retries, workflow retries)
- ‚ùå Timing information (scan duration, avg time per extension)
- ‚úÖ Progress bar (kept - shows user scan is active)
- ‚úÖ Security findings (kept - primary focus)
- ‚úÖ File output confirmation (kept - important feedback)

**Implementation Strategy:**
```python
# scanner.py - Split summary into 3 modes
def _print_summary(extensions, stats, duration, use_rich, results, quiet, verbose):
    if quiet:
        _print_quiet_summary(...)      # Existing: minimal single-line
    elif verbose:
        _print_verbose_summary(...)    # Enhanced: show everything
    else:
        _print_standard_summary(...)   # NEW: security-focused only

# Each mode has Rich and Plain variants
def _print_standard_summary(stats, use_rich):
    if use_rich:
        _print_standard_summary_rich(stats)
    else:
        _print_standard_summary_plain(stats)

def _print_verbose_summary(stats, cache_stats, retry_stats, duration, use_rich):
    if use_rich:
        _print_verbose_summary_rich(...)
    else:
        _print_verbose_summary_plain(...)
```

**Rich/Plain Compatibility Matrix:**

| Element | Rich Mode | Plain Mode |
|---------|-----------|------------|
| Section headings | Rich Panel with colors | Text with `===` separator |
| Security summary | Rich Table with colors | Plain text with bullets |
| Cache stats (verbose) | Rich Table | Plain text table |
| Retry stats (verbose) | Rich Table | Plain text with indentation |
| Colors | Risk-based colors (red/yellow/green) | No colors |

**Files Modified:**
1. `vscode_scanner/scanner.py`:
   - Split `_print_summary()` into mode-specific functions
   - Add verbose flag checks before displaying operational info
   - Create `_print_standard_summary()` for security-focused output
   - Enhance `_print_verbose_summary()` with all details

2. `vscode_scanner/display.py`:
   - Add `create_security_summary_table(stats, use_rich)`
   - Add `create_verbose_details_table(cache_stats, retry_stats, use_rich)`
   - Ensure all functions have Rich and Plain variants

3. `vscode_scanner/cli.py`:
   - Update `--verbose` help text to clarify it shows operational details
   - Add examples to help text

**Testing Requirements:**
Test all combinations (3 modes √ó 2 formats = 6 test cases):
1. Quiet + Rich
2. Quiet + Plain
3. Standard + Rich (NEW)
4. Standard + Plain (NEW)
5. Verbose + Rich
6. Verbose + Plain

**Verification:**
- Run scan with vulnerabilities found
- Verify standard mode hides cache/retry/timing info
- Verify verbose mode shows all details
- Check both Rich and Plain outputs for each mode

**Success Criteria:**
- ‚úÖ Standard mode shows security findings prominently
- ‚úÖ Operational details hidden in standard mode
- ‚úÖ Verbose mode shows all information
- ‚úÖ Both Rich and Plain modes work correctly
- ‚úÖ Help text clearly explains modes

---

### Feature 3: Failed Extensions Tracking & Reporting

**Priority:** MEDIUM (UX Enhancement)
**Complexity:** MEDIUM
**Estimated Effort:** 5-7 hours

**Problem:**
When extensions fail to scan (API errors, rate limits, timeouts), users only see a count. They don't know which extensions failed or why, making it difficult to troubleshoot or retry specific extensions.

**Solution:**
Track failed extensions during scan and display a summary table with extension names and error categories. Provide actionable suggestions for resolution.

**Display Format (Rich Mode):**
```
‚ö† Failed to Scan (3 extensions)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Extension                    ‚îÇ Error           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ms-python.python             ‚îÇ API error       ‚îÇ
‚îÇ esbenp.prettier-vscode       ‚îÇ Rate limit      ‚îÇ
‚îÇ local.test-extension         ‚îÇ Network timeout ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Suggestion: Re-run with --delay 3.0 or --max-retries 5
```

**Display Format (Plain Mode):**
```
‚ö† Failed to Scan (3 extensions)
========================================
ms-python.python - API error
esbenp.prettier-vscode - Rate limit
local.test-extension - Network timeout

Suggestion: Re-run with --delay 3.0 or --max-retries 5
```

**JSON Schema Addition:**
```json
{
  "summary": {
    "total_extensions_scanned": 66,
    "failed_scans": 3,
    "failed_extensions": [
      {
        "id": "ms-python.python",
        "name": "Python",
        "error_type": "api_error",
        "error_message": "API error"
      },
      {
        "id": "esbenp.prettier-vscode",
        "name": "Prettier - Code formatter",
        "error_type": "rate_limit",
        "error_message": "Rate limit"
      }
    ]
  }
}
```

**Error Categorization:**

Simple categorization for user-friendly display:
- `rate_limit` - HTTP 429 or "rate limit" in error message
- `network_timeout` - "timeout" in error message
- `network_error` - "network" or "connection" in error message
- `api_error` - Generic catch-all for other API errors

**Implementation:**

```python
# scanner.py - Track failures during scan
stats = {
    'scanned_count': 0,
    'cached_results': 0,
    'fresh_scans': 0,
    'vulnerabilities_found': 0,
    'failed_scans': 0,
    'failed_extensions': []  # NEW: List of dicts
}

# In _scan_extensions() - Capture failures
try:
    result = api_client.scan_extension(...)
    # ... handle success ...
except Exception as e:
    stats['failed_scans'] += 1
    stats['failed_extensions'].append({
        'id': ext['id'],
        'name': ext.get('name', ext['id']),
        'error_type': _categorize_error(e),
        'error_message': _simplify_error_message(e)
    })
    log(f"Failed to scan {ext['id']}: {e}", "WARNING")
    continue  # Continue scanning other extensions

# Error categorization helper
def _categorize_error(exception: Exception) -> str:
    """Categorize exception into user-friendly error type."""
    error_str = str(exception).lower()

    if 'rate limit' in error_str or '429' in error_str:
        return 'rate_limit'
    elif 'timeout' in error_str:
        return 'network_timeout'
    elif 'network' in error_str or 'connection' in error_str:
        return 'network_error'
    else:
        return 'api_error'

def _simplify_error_message(error_type: str) -> str:
    """Convert error type to user-friendly message."""
    messages = {
        'rate_limit': 'Rate limit',
        'network_timeout': 'Network timeout',
        'network_error': 'Network error',
        'api_error': 'API error'
    }
    return messages.get(error_type, 'API error')

# Display failures if any exist
if stats['failed_extensions']:
    if use_rich:
        display.display_failed_extensions_rich(stats['failed_extensions'])
    else:
        display.display_failed_extensions_plain(stats['failed_extensions'])
```

**Rich/Plain Implementation:**

```python
# display.py

def display_failed_extensions_rich(failed_extensions: List[Dict]) -> None:
    """Display failed extensions in Rich format."""
    from rich.console import Console
    from rich.table import Table

    console = Console()

    # Warning header
    console.print(f"\n[yellow]‚ö† Failed to Scan ({len(failed_extensions)} extensions)[/yellow]\n")

    # Create table
    table = Table(show_header=True, header_style="bold yellow")
    table.add_column("Extension", style="cyan")
    table.add_column("Error", style="red")

    for ext in failed_extensions:
        table.add_row(ext['name'], ext['error_message'])

    console.print(table)

    # Suggestion
    console.print("\n[dim]Suggestion: Re-run with --delay 3.0 or --max-retries 5[/dim]\n")

def display_failed_extensions_plain(failed_extensions: List[Dict]) -> None:
    """Display failed extensions in plain format."""
    print(f"\n‚ö† Failed to Scan ({len(failed_extensions)} extensions)")
    print("=" * 60)

    for ext in failed_extensions:
        print(f"{ext['name']} - {ext['error_message']}")

    print("\nSuggestion: Re-run with --delay 3.0 or --max-retries 5\n")
```

**Files Modified:**
1. `vscode_scanner/scanner.py`:
   - Add `failed_extensions` list to stats dict
   - Capture failures in exception handlers
   - Add `_categorize_error()` and `_simplify_error_message()` helpers
   - Call display functions if failures exist

2. `vscode_scanner/display.py`:
   - Add `display_failed_extensions_rich()`
   - Add `display_failed_extensions_plain()`

3. `vscode_scanner/output_formatter.py`:
   - Add `failed_extensions` to JSON schema in `format_output()`
   - Include in summary section

**Testing Requirements:**
- Mock API to return different error types (rate limit, timeout, network, generic)
- Verify error categorization works correctly
- Test Rich mode table display
- Test Plain mode list display
- Verify JSON output includes failed_extensions array
- Test empty failures (no display shown)
- Test mixed success/failure scenarios

**Success Criteria:**
- ‚úÖ Failed extensions tracked during scan
- ‚úÖ Clear display in both Rich and Plain modes
- ‚úÖ Error categorization is accurate
- ‚úÖ JSON output includes detailed failure info
- ‚úÖ Helpful suggestions provided
- ‚úÖ No display when all scans succeed

---

### Feature 4: Parallel Scanning (Optional)

**Priority:** LOW (Performance Enhancement)
**Complexity:** HIGH
**Estimated Effort:** 12-16 hours

**Status:** OPTIONAL - Can be deferred to v3.4.0 if time-constrained

**Problem:**
Scanning large extension sets (50-100 extensions) is slow due to sequential API calls. With default 1.5s delay between requests, 66 extensions take ~1.6 minutes even with cache.

**Solution:**
Implement optional parallel scanning with 2-3 concurrent workers. Conservative approach to avoid rate limiting.

**CLI Usage:**
```bash
# Enable parallel scanning (default: 3 workers)
vscan scan --parallel

# Custom worker count (2-3 max)
vscan scan --parallel --workers 2

# Config file support
[scan]
parallel = false          # Enable by default
workers = 3              # Number of concurrent workers
```

**Progress Display (Rich Mode):**
```
Scanning 66 extensions (3 parallel workers)...
[Worker 1] ms-python.python ‚ö°
[Worker 2] esbenp.prettier-vscode üîç
[Worker 3] dbaeumer.vscode-eslint üîç
[=========>          ] 25/66
```

**Progress Display (Plain Mode):**
```
Scanning 66 extensions (3 parallel workers)...
[===>  ] 25/66 extensions scanned
```

**Implementation Strategy:**

```python
# scanner.py
def _scan_extensions(extensions, api_client, cache_manager, args, use_rich, quiet, verbose):
    """Route to parallel or sequential based on flag."""
    if args.parallel:
        return _scan_extensions_parallel(extensions, cache_manager, args, use_rich, quiet, verbose)
    else:
        return _scan_extensions_sequential(extensions, api_client, cache_manager, args, use_rich, quiet, verbose)

def _scan_extensions_parallel(extensions, cache_manager, args, use_rich, quiet, verbose):
    """Parallel scanning with ThreadPoolExecutor."""
    from concurrent.futures import ThreadPoolExecutor, as_completed

    max_workers = min(args.workers, 3)  # Hard cap at 3
    results = []
    stats = {
        'scanned_count': 0,
        'cached_results': 0,
        'fresh_scans': 0,
        'vulnerabilities_found': 0,
        'failed_scans': 0,
        'failed_extensions': []
    }

    # Create progress tracking
    if use_rich and not quiet:
        progress = create_scan_progress()
        task_id = progress.add_task(
            f"[cyan]Scanning ({max_workers} workers)...",
            total=len(extensions)
        )
        progress.start()

    try:
        with ThreadPoolExecutor(max_workers=max_workers) as executor:
            # Submit all tasks
            futures = {}
            for ext in extensions:
                future = executor.submit(
                    _scan_single_extension,
                    ext,
                    cache_manager,
                    args
                )
                futures[future] = ext

            # Collect results as they complete
            for future in as_completed(futures):
                ext = futures[future]
                try:
                    result, from_cache = future.result()
                    results.append(result)

                    # Update stats
                    stats['scanned_count'] += 1
                    if from_cache:
                        stats['cached_results'] += 1
                    else:
                        stats['fresh_scans'] += 1

                    if result.get('security', {}).get('vulnerabilities', {}).get('total', 0) > 0:
                        stats['vulnerabilities_found'] += 1

                    # Update progress
                    if use_rich and not quiet:
                        progress.update(task_id, advance=1)

                except Exception as e:
                    # Track failure
                    stats['failed_scans'] += 1
                    stats['failed_extensions'].append({
                        'id': ext['id'],
                        'name': ext.get('name', ext['id']),
                        'error_type': _categorize_error(e),
                        'error_message': _simplify_error_message(e)
                    })

                    if use_rich and not quiet:
                        progress.update(task_id, advance=1)

    finally:
        if use_rich and not quiet:
            progress.stop()

    return results, stats

def _scan_single_extension(ext, cache_manager, args):
    """Worker function for scanning single extension."""
    # Each worker gets own API client (thread-safe)
    api_client = VscanAPIClient(
        delay=args.delay,
        max_retries=args.max_retries,
        retry_delay=args.retry_delay
    )

    # Check cache first (cache_manager is thread-safe)
    if cache_manager and not args.refresh_cache:
        cached_result = cache_manager.get_cached_result(ext['id'], ext['version'])
        if cached_result:
            return cached_result, True  # from_cache=True

    # Scan fresh
    result = api_client.scan_extension(ext['publisher'], ext['name'])

    # Cache result (cache_manager handles thread-safety)
    if cache_manager and result.get('scan_status') == 'success':
        cache_manager.save_result(ext['id'], ext['version'], result)

    return result, False  # from_cache=False
```

**Rate Limit Protection:**
- Each worker has own API client with delay
- Distribute global delay across workers (e.g., 1.5s / 3 workers = 0.5s per worker)
- Exponential backoff still applies per-worker
- Monitor for rate limit errors and fall back to sequential if detected

**Thread Safety:**
- Each worker gets separate VscanAPIClient instance (no shared state)
- SQLite cache_manager is thread-safe for read/write (uses connection pooling)
- Stats collection uses thread-safe list append and atomic counters

**Files Modified:**
1. `vscode_scanner/scanner.py`:
   - Add `_scan_extensions_parallel()`
   - Add `_scan_single_extension()` worker function
   - Route based on `args.parallel` flag

2. `vscode_scanner/vscan_api.py`:
   - Verify thread-safety (each worker uses separate instance)
   - No shared state between instances

3. `vscode_scanner/display.py`:
   - Update progress display for parallel mode
   - Add worker status (Rich mode only)

4. `vscode_scanner/cli.py`:
   - Add `--parallel` flag (default: False)
   - Add `--workers` option (default: 3, range: 2-3)

5. `vscode_scanner/config_manager.py`:
   - Add `parallel` and `workers` to `CONFIG_SCHEMA['scan']`
   - Add to `DEFAULT_CONFIG` and template

**Rich/Plain Compatibility:**

| Element | Rich Mode | Plain Mode |
|---------|-----------|------------|
| Progress bar | Live with worker status | Simple text progress |
| Worker info | Show per-worker activity | Hide (just show count) |
| Completion | Rich panel with stats | Plain text summary |

**Testing Requirements:**
- Unit tests with mocked API (simulate parallel execution)
- Test worker count limits (2-3 enforced)
- Test rate limit handling (fall back to sequential)
- Test keyboard interrupt (cleanup all workers)
- Test cache thread-safety (concurrent reads/writes)
- Integration test with 10-20 real extensions
- Compare sequential vs parallel timing
- Test both Rich and Plain modes

**Performance Expectations:**
- **Sequential (66 ext, 1.5s delay):** ~100 seconds
- **Parallel 3x (66 ext, 0.5s delay/worker):** ~35-40 seconds
- **Speedup:** ~2.5-3x faster

**Risks & Mitigation:**
- ‚ö†Ô∏è **Unknown rate limits** - Start conservative (2-3 workers), monitor for 429 errors
- ‚ö†Ô∏è **Thread safety** - Careful testing of cache operations, use separate API clients
- ‚ö†Ô∏è **Complexity** - Defer to v3.4 if time-constrained

**Success Criteria:**
- ‚úÖ Parallel mode speeds up scans by 2-3x
- ‚úÖ No rate limit issues with 3 workers
- ‚úÖ Thread-safe cache operations
- ‚úÖ Graceful handling of keyboard interrupt
- ‚úÖ Both Rich and Plain modes work
- ‚úÖ Optional (disabled by default)

---

## Implementation Phases

### Phase 1: Documentation Setup (2 hours)

**Tasks:**
1. ‚úÖ Create `docs/project/v3.3-ROADMAP.md` (this document)
2. Clean up `docs/project/STATUS.md`
   - Archive verbose details to `docs/archive/summaries/`
   - Keep only current version and v3.2 summary (5-10 lines)
   - Reduce from ~1400 lines to ~150-200 lines
3. Update `docs/project/PRD.md` to version 3.3.0
   - Add Feature 3.7: Failed Extensions Reporting
   - Add Feature 3.8: Parallel Scanning
   - Update CLI examples
   - Update config file examples
4. Update `CLAUDE.md` current status

**Deliverables:**
- ‚úÖ v3.3 ROADMAP created
- ‚úÖ STATUS.md cleaned up
- ‚úÖ PRD.md updated
- ‚úÖ CLAUDE.md updated

---

### Phase 2: Foundation Features (6-8 hours)

**Feature 1: Extension Directory in Config** (2-3 hours)

**Tasks:**
1. Update `config_manager.py`:
   - Add `extensions_dir` to `CONFIG_SCHEMA['scan']`
   - Add to `DEFAULT_CONFIG['scan']` (None default)
   - Add to `DEFAULT_CONFIG_TEMPLATE` with comment
2. Update `cli.py`:
   - Load from config if CLI arg not provided
   - Verify precedence: CLI > config > auto-detect
3. Testing:
   - Config set/get extensions_dir
   - CLI override
   - Path expansion (~)

**Feature 2: Enhanced Verbose Mode** (4-6 hours)

**Tasks:**
1. Update `scanner.py`:
   - Split `_print_summary()` into 3 mode functions
   - Implement `_print_standard_summary()` (security-focused)
   - Enhance `_print_verbose_summary()` (all details)
   - Each function supports Rich and Plain
2. Update `display.py`:
   - Add `create_security_summary_table(stats, use_rich)`
   - Add Rich and Plain variants
3. Update `cli.py`:
   - Update `--verbose` help text
4. Testing:
   - Test 6 combinations (3 modes √ó 2 formats)
   - Verify operational info hidden in standard
   - Verify all info shown in verbose

**Deliverables:**
- ‚úÖ Extension directory configurable
- ‚úÖ Three distinct output modes working
- ‚úÖ Both Rich and Plain modes tested

---

### Phase 3: UX Enhancements (8-12 hours)

**Feature 3: Failed Extensions Tracking** (8-12 hours)

**Tasks:**
1. Update `scanner.py`:
   - Add `failed_extensions` list to stats
   - Capture failures in exception handlers
   - Add `_categorize_error()` helper
   - Add `_simplify_error_message()` helper
   - Display failures if any exist
2. Update `display.py`:
   - Implement `display_failed_extensions_rich()`
   - Implement `display_failed_extensions_plain()`
3. Update `output_formatter.py`:
   - Add `failed_extensions` to JSON schema
4. Testing:
   - Mock different error types
   - Test Rich table display
   - Test Plain list display
   - Verify JSON output
   - Test empty failures

**Deliverables:**
- ‚úÖ Failed extensions tracked and displayed
- ‚úÖ Error categorization working
- ‚úÖ Both Rich and Plain displays tested
- ‚úÖ JSON output includes failures

---

### Phase 4: Performance (12-16 hours) - OPTIONAL

**Feature 4: Parallel Scanning** (12-16 hours)

**Tasks:**
1. Update `scanner.py`:
   - Implement `_scan_extensions_parallel()`
   - Implement `_scan_single_extension()` worker
   - Route based on `--parallel` flag
2. Update `vscan_api.py`:
   - Verify thread-safety
3. Update `display.py`:
   - Parallel progress display (Rich and Plain)
4. Update `cli.py`:
   - Add `--parallel` flag
   - Add `--workers` option
5. Update `config_manager.py`:
   - Add parallel config options
6. Testing:
   - Unit tests with mocked API
   - Test worker limits
   - Test rate limit handling
   - Test keyboard interrupt
   - Integration test with real extensions
   - Performance comparison

**Deliverables:**
- ‚úÖ Parallel scanning working (opt-in)
- ‚úÖ 2-3x performance improvement
- ‚úÖ Thread-safe operations
- ‚úÖ Both Rich and Plain modes tested

**Note:** This phase is OPTIONAL and can be deferred to v3.4.0

---

## Rich/Plain Mode Compatibility Requirements

**Every user-facing display MUST support both modes.**

### Testing Matrix

| Feature | Rich Mode | Plain Mode | Test Status |
|---------|-----------|------------|-------------|
| Extension dir config | Config display | Config display | ‚è≥ Pending |
| Quiet summary | Minimal | Minimal | ‚è≥ Pending |
| Standard summary (NEW) | Panel + Table | Text + Bullets | ‚è≥ Pending |
| Verbose summary | Panel + Tables | Text + Tables | ‚è≥ Pending |
| Failed extensions | Red Table | Text List | ‚è≥ Pending |
| Parallel progress | Live + Workers | Simple Bar | ‚è≥ Pending |

### Implementation Checklist

For each feature:
- [ ] Implement Rich variant with colors/tables/panels
- [ ] Implement Plain variant with text/bullets/tables
- [ ] Add `if use_rich:` branching
- [ ] Test both modes manually
- [ ] Add automated tests for both modes

---

## Testing Strategy

### Unit Tests
- Config file operations (set/get extensions_dir)
- Error categorization logic
- Summary formatting (all 3 modes √ó 2 formats)
- Parallel worker creation and cleanup

### Integration Tests
- Full scan with failed extensions
- Parallel vs sequential comparison
- Config precedence (CLI > config > default)

### Manual Testing
```bash
# Test all modes in both Rich and Plain
vscan scan --quiet                    # Minimal
vscan scan --quiet --plain
vscan scan                           # Standard (security-focused)
vscan scan --plain
vscan scan --verbose                 # Full details
vscan scan --verbose --plain

# Test failed extensions (trigger with invalid extensions)
vscan scan --include-ids "fake.extension"

# Test parallel scanning
vscan scan --parallel
vscan scan --parallel --workers 2

# Test config file
vscan config set scan.extensions_dir ~/custom/path
vscan scan  # Should use config value
vscan scan --extensions-dir /tmp  # Should override
```

---

## Success Criteria

### Phase 1 (Documentation)
- ‚úÖ v3.3 ROADMAP created with all feature specs
- ‚úÖ STATUS.md reduced to ~200 lines (from ~1400)
- ‚úÖ PRD.md updated to v3.3.0
- ‚úÖ CLAUDE.md updated

### Phase 2 (Foundation)
- ‚úÖ Extension directory configurable in ~/.vscanrc
- ‚úÖ Three output modes working (quiet/standard/verbose)
- ‚úÖ Standard mode hides operational details
- ‚úÖ Both Rich and Plain modes tested

### Phase 3 (UX)
- ‚úÖ Failed extensions tracked and displayed
- ‚úÖ Error categorization accurate and helpful
- ‚úÖ JSON output includes failure details
- ‚úÖ Both Rich and Plain displays working

### Phase 4 (Performance - Optional)
- ‚úÖ Parallel scanning 2-3x faster
- ‚úÖ No rate limit issues with 3 workers
- ‚úÖ Thread-safe cache operations
- ‚úÖ Opt-in with `--parallel` flag

---

## Timeline Estimate

| Phase | Duration | Status |
|-------|----------|--------|
| Phase 1: Documentation | 2 hours | ‚è≥ In Progress |
| Phase 2: Foundation | 6-8 hours | ‚è≥ Pending |
| Phase 3: UX | 8-12 hours | ‚è≥ Pending |
| Phase 4: Performance (Optional) | 12-16 hours | ‚è≥ Pending |
| **Total (Phases 1-3)** | **16-22 hours** | |
| **Total (All Phases)** | **28-38 hours** | |

**Recommendation:** Complete Phases 1-3 for v3.3.0, defer Phase 4 to v3.4.0 if time-constrained.

---

## Open Questions

1. **Parallel Scanning Rate Limits:**
   - Should we test against vscan.dev with 3 workers to validate rate limit assumptions?
   - If we hit rate limits, should we auto-fall back to sequential or just fail with error?

2. **Failed Extension Retry:**
   - Should we add `--retry-failed-ids` option to retry only failed extensions from previous scan?
   - Would require persisting failed extensions list (add to cache or separate file?)

---

## Documentation Updates Needed

After implementation:
- [ ] Update CLI help text with new examples
- [ ] Add parallel scanning section to `ARCHITECTURE.md`
- [ ] Add failed extensions section to `ERROR_HANDLING.md`
- [ ] Update README.md with v3.3 features
- [ ] Create `docs/archive/summaries/v3.3-completion-summary.md` (on completion)
- [ ] Archive this ROADMAP to `docs/archive/plans/v3.3-roadmap.md` (on completion)

---

**Document Version:** 1.0
**Status:** Active Planning Document
**Next Review:** After Phase 2 completion
