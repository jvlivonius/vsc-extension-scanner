# Coverage Improvement Roadmap: v3.6
# Target: 75% Coverage Per File

**Document Type:** Implementation Roadmap
**Target Release:** v3.6.0
**Created:** 2025-11-02
**Status:** Planning
**Owner:** Development Team
**Tracking:** [Test Case Checklist](v3.6-test-case-checklist.md)

---

## Executive Summary

This roadmap outlines the plan to improve code coverage from the current 72.60% overall to 75%+ per file (minimum) by targeting specific modules with coverage gaps. The focus is on achieving consistent, high-quality test coverage across all production modules.

### Current State (v3.5.3)
- **Overall Coverage:** 72.60% âœ… (exceeds 70% target)
- **Total Tests:** 628 tests (100% passing)
- **Property Tests:** 1,250+ scenarios
- **Security Coverage:** 95%+ âœ…

### Target State (v3.6.0)
- **Per-File Coverage:** 75%+ for 10 of 12 main modules
- **Overall Coverage:** 80%+ (stretch: 85%)
- **Total Tests:** 1,000+ tests
- **Branch Coverage:** 85%+

---

## Coverage Gap Analysis

### Files Below 75% Target

| Priority | Module | Current | Target | Gap | Effort |
|----------|--------|---------|--------|-----|--------|
| ðŸ”´ **Critical** | config_manager.py | 57.48% | 75% | +17.52% | High |
| ðŸ”´ **Critical** | scanner.py | 60.29% | 75% | +14.71% | High |
| ðŸ”´ **Critical** | cache_manager.py | 60.54% | 75% | +14.46% | High |
| ðŸ”´ **Critical** | utils.py | 64.50% | 75% | +10.50% | Medium |
| ðŸŸ¡ **Medium** | output_formatter.py | 62.30% | 75% | +12.70% | Medium |
| ðŸŸ¡ **Medium** | extension_discovery.py | 63.98% | 75% | +11.02% | Medium |
| ðŸŸ¢ **Low** | cli.py | 17.55% | 50% | +32.45% | High* |

*CLI has revised target of 50% due to Typer framework complexity

### Files Already Exceeding Target âœ…

| Module | Coverage | Status |
|--------|----------|--------|
| constants.py | 100.00% | âœ… Perfect |
| types.py | 100.00% | âœ… Perfect |
| display.py | 80.58% | âœ… Exceeds |
| vscan_api.py | 77.99% | âœ… Exceeds |

---

## Implementation Phases

### Phase 1: Security Module Hardening
**Timeline:** Week 1 (10-16 hours)
**Target Modules:** cache_manager.py, utils.py

#### cache_manager.py (60.54% â†’ 75%)

**Current Coverage:** 508 statements, 194 missing (60.54%)
**Target:** 381 statements covered (75%)
**Gap:** ~97 statements need coverage

**Test Scenarios to Add:**

1. **Error Recovery (30 tests)**
   - Database corruption detection and recovery
   - Disk full scenarios during write operations
   - SQLite lock timeout handling
   - Concurrent access conflicts
   - Transaction rollback edge cases
   - Cache file permission errors

2. **Threading Edge Cases (20 tests)**
   - Race conditions in cache reads/writes
   - Thread-safe stats collection
   - Deadlock prevention verification
   - Worker thread failures during parallel scans
   - Main thread database write serialization

3. **Batch Operations (10 tests)**
   - Batch insert failures (partial success)
   - Large batch size handling (>1000 records)
   - Batch transaction atomicity
   - Batch operation cancellation

4. **Migration and Integrity (10 tests)**
   - Cache schema migration paths
   - HMAC signature verification edge cases
   - Data corruption detection
   - Legacy cache format handling

**Test Files:**
- `tests/test_cache_error_recovery.py` (new)
- `tests/test_cache_threading.py` (new)
- Enhance `tests/test_cache_integrity.py`
- Enhance `tests/test_transactional_cache.py`

**Estimated Effort:** 8-12 hours, 70 new test cases

---

#### utils.py (64.50% â†’ 75%)

**Current Coverage:** 192 statements, 63 missing (64.50%)
**Target:** 144 statements covered (75%)
**Gap:** ~21 statements need coverage
**Note:** Security functions already at 95%+, focus on utilities

**Test Scenarios to Add:**

1. **Utility Functions (20 tests)**
   - `format_duration()` edge cases (0s, negative, huge values, milliseconds)
   - `truncate_text()` edge cases (empty, unicode, emoji, exact length)
   - `get_terminal_width()` fallback behavior
   - `ensure_parent_dir()` complex path scenarios

2. **Error Formatting (10 tests)**
   - Error message sanitization edge cases
   - Long error message truncation
   - Unicode in error messages
   - Error context extraction

3. **Path Utilities (5 tests)**
   - UNC path handling (Windows network paths)
   - Network drive detection
   - Case sensitivity variations
   - Path normalization edge cases

4. **String Processing (5 tests)**
   - Multi-byte character handling
   - Emoji and special character sanitization
   - Very long string truncation
   - Empty string edge cases

**Test Files:**
- Enhance `tests/test_utils.py` (currently 40 tests â†’ 80 tests)
- Add property tests to `tests/test_property_validation.py`

**Estimated Effort:** 4-6 hours, 40 new test cases

---

### Phase 2: Core Business Logic
**Timeline:** Week 2 (16-22 hours)
**Target Modules:** scanner.py, config_manager.py

#### scanner.py (60.29% â†’ 75%)

**Current Coverage:** 565 statements, 199 missing (60.29%)
**Target:** 424 statements covered (75%)
**Gap:** ~85 statements need coverage

**Test Scenarios to Add:**

1. **Error Recovery Workflows (30 tests)**
   - Individual extension scan failures (continue scanning)
   - API timeout recovery with retry exhaustion
   - Cache write failures during scan
   - Partial results when API fails mid-scan
   - Network disconnection during batch scanning

2. **Complex Filter Combinations (20 tests)**
   - Multiple filters applied simultaneously
   - Publisher + risk level + verified filters
   - Include/exclude ID combinations
   - Edge cases with empty filter results
   - Filter validation errors

3. **Thread Synchronization (15 tests)**
   - Worker thread failures and recovery
   - Stats collection race conditions
   - Shared cache manager access patterns
   - Graceful worker termination
   - Thread pool exhaustion scenarios

4. **Partial Failure Scenarios (10 tests)**
   - Some extensions succeed, some fail
   - Mixed cache hit/miss with API errors
   - Interrupted scans and resume capability
   - Failed extension tracking accuracy

5. **Signal Handling (5 tests)**
   - SIGINT graceful shutdown
   - SIGTERM handling
   - Cleanup on unexpected termination

**Test Files:**
- Enhance `tests/test_scanner.py`
- Enhance `tests/test_parallel_scanning.py`
- `tests/test_scanner_error_recovery.py` (new)
- `tests/test_scanner_filters.py` (new)

**Estimated Effort:** 10-14 hours, 80 new test cases

---

#### config_manager.py (57.48% â†’ 75%)

**Current Coverage:** 146 statements, 56 missing (57.48%)
**Target:** 110 statements covered (75%)
**Gap:** ~26 statements need coverage

**Test Scenarios to Add:**

1. **Validation Error Paths (20 tests)**
   - Invalid type coercion attempts
   - Out-of-range integer values
   - Invalid float values (NaN, Inf)
   - Invalid choice values
   - Malformed path values
   - Empty required fields

2. **File Operation Errors (15 tests)**
   - Config file permission denied
   - Disk full during config save
   - Directory creation failures
   - Concurrent config file access
   - Config file corruption recovery

3. **Malformed Configuration (10 tests)**
   - Invalid INI syntax
   - Missing sections
   - Duplicate keys
   - Unicode encoding errors
   - Very large config files

4. **Type Coercion Edge Cases (5 tests)**
   - Boolean parsing ("yes", "no", "1", "0", "true", "false")
   - Integer overflow handling
   - Float precision edge cases
   - Path expansion (~ and environment variables)

**Test Files:**
- Enhance `tests/test_config_manager.py`
- `tests/test_config_validation.py` (new)
- Enhance `tests/test_config_commands.py`

**Estimated Effort:** 6-8 hours, 50 new test cases

---

### Phase 3: Infrastructure Layer
**Timeline:** Week 3 (9-13 hours)
**Target Modules:** extension_discovery.py, output_formatter.py

#### extension_discovery.py (63.98% â†’ 75%)

**Current Coverage:** 155 statements, 53 missing (63.98%)
**Target:** 116 statements covered (75%)
**Gap:** ~17 statements need coverage

**Test Scenarios to Add:**

1. **Symlink Handling (15 tests)**
   - Circular symlink detection
   - Broken symlink handling
   - External symlinks (outside extensions dir)
   - Symlink chains (A â†’ B â†’ C)
   - Permission denied on symlink targets

2. **Permission Errors (10 tests)**
   - Read permission denied on extension directory
   - Read permission denied on package.json
   - Execute permission denied on directory
   - Mixed permissions across extensions

3. **Malformed package.json (10 tests)**
   - Invalid JSON syntax
   - Missing required fields (name, version)
   - Invalid field types
   - Very large package.json files (>1MB)
   - Empty package.json

4. **Large Directory Handling (5 tests)**
   - >1000 extensions in directory
   - Deep directory nesting
   - Very long file paths (>260 chars on Windows)
   - Unicode directory names

**Test Files:**
- Enhance `tests/test_extension_discovery.py`
- `tests/test_extension_discovery_edge_cases.py` (new)

**Estimated Effort:** 5-7 hours, 40 new test cases

---

#### output_formatter.py (62.30% â†’ 75%)

**Current Coverage:** 102 statements, 42 missing (62.30%)
**Target:** 77 statements covered (75%)
**Gap:** ~13 statements need coverage

**Test Scenarios to Add:**

1. **CSV Edge Cases (15 tests)**
   - Special characters in fields (commas, quotes, newlines)
   - Very large field values (>10KB)
   - Unicode and emoji in CSV
   - CSV injection prevention
   - Empty field handling
   - Null/None value handling

2. **JSON Unicode Handling (10 tests)**
   - Emoji in extension names
   - Non-ASCII characters
   - RTL (right-to-left) text
   - Combining characters
   - Zero-width characters

3. **Large Dataset Handling (5 tests)**
   - >1000 extensions export
   - >10,000 record export
   - Memory efficiency validation
   - Streaming write for large datasets

4. **File Write Errors (5 tests)**
   - Disk full during write
   - Permission denied on output file
   - Invalid output path
   - Output directory doesn't exist

**Test Files:**
- Enhance `tests/test_output_formatter.py`
- `tests/test_output_edge_cases.py` (new)

**Estimated Effort:** 4-6 hours, 35 new test cases

---

### Phase 4: CLI Improvement (Stretch Goal)
**Timeline:** Week 4 (8-10 hours)
**Target Module:** cli.py (17.55% â†’ 50%)

#### cli.py (17.55% â†’ 50%)

**Current Coverage:** 564 statements, 455 missing (17.55%)
**Target:** 282 statements covered (50%)
**Gap:** ~183 statements need coverage
**Note:** Revised target due to Typer framework complexity

**Test Scenarios to Add:**

1. **Command Integration Tests (25 tests)**
   - All command combinations
   - Flag interaction testing
   - Mutually exclusive options
   - Required argument validation

2. **Argument Validation (15 tests)**
   - Invalid argument types
   - Out-of-range values
   - Missing required arguments
   - Too many arguments

3. **Interactive Prompts (10 tests)**
   - Confirmation prompts (yes/no)
   - Cache clear confirmation
   - Config reset confirmation
   - User input validation

4. **Exit Code Verification (10 tests)**
   - Exit 0 (success, no vulnerabilities)
   - Exit 1 (success, vulnerabilities found)
   - Exit 2 (scan failed)
   - Exit on errors

**Test Files:**
- Enhance `tests/test_cli.py`
- Enhance `tests/test_cli_coverage_boost.py`
- `tests/test_cli_integration.py` (new)

**Estimated Effort:** 8-10 hours, 60 new test cases

---

## Milestone Targets

### Milestone 1: Security Excellence (End of Week 1)
**Completion Criteria:**
- âœ… cache_manager.py: 75%+ coverage
- âœ… utils.py: 75%+ coverage
- âœ… 110 new test cases added
- âœ… All tests passing (100% pass rate)
- âœ… Security modules maintain 95%+

**Expected Overall Coverage:** ~74%

**Deliverables:**
- Updated test files for cache and utils
- Coverage report showing per-file improvements
- Documentation updates in TESTING.md

---

### Milestone 2: Core Logic Hardening (End of Week 2)
**Completion Criteria:**
- âœ… scanner.py: 75%+ coverage
- âœ… config_manager.py: 75%+ coverage
- âœ… 240 total new test cases (cumulative)
- âœ… All tests passing (100% pass rate)
- âœ… Branch coverage: 85%+

**Expected Overall Coverage:** ~77%

**Deliverables:**
- Enhanced scanner and config test suites
- Error recovery test documentation
- Updated STATUS.md with new metrics

---

### Milestone 3: Infrastructure Complete (End of Week 3)
**Completion Criteria:**
- âœ… extension_discovery.py: 75%+ coverage
- âœ… output_formatter.py: 75%+ coverage
- âœ… 315 total new test cases (cumulative)
- âœ… All tests passing (100% pass rate)
- âœ… Overall coverage: 80%+

**Expected Overall Coverage:** ~80%

**Deliverables:**
- Complete test suite for infrastructure layer
- Coverage report archived in `docs/archive/reviews/v3.6-coverage-report.html`
- v3.6.0 release candidate ready

---

### Milestone 4: CLI Enhancement (End of Week 4 - Stretch)
**Completion Criteria:**
- âœ… cli.py: 50%+ coverage
- âœ… 375 total new test cases (cumulative)
- âœ… All tests passing (100% pass rate)
- âœ… Overall coverage: 82%+

**Expected Overall Coverage:** ~82%

**Deliverables:**
- Enhanced CLI test suite
- Integration test documentation
- v3.6.0 release ready

---

## Success Criteria

### Primary Goals (MUST HAVE)
- âœ… 10 of 12 main modules at 75%+ coverage
- âœ… cli.py at 50%+ (acceptable for CLI framework)
- âœ… Security modules maintain 95%+ coverage
- âœ… Overall coverage: 80%+
- âœ… 100% test pass rate maintained
- âœ… Zero new security vulnerabilities introduced

### Secondary Goals (SHOULD HAVE)
- âœ… Branch coverage: 85%+
- âœ… Total tests: 1,000+ (currently 628)
- âœ… Property test scenarios: 1,500+
- âœ… Test execution time: <60 seconds
- âœ… No flaky tests (100% reproducible)

### Stretch Goals (NICE TO HAVE)
- âœ… Overall coverage: 85%+
- âœ… All modules except cli.py at 80%+
- âœ… Branch coverage: 90%+
- âœ… Mutation testing score: 75%+

---

## Implementation Strategy

### 1. Test-First Development (TDD)
- Write failing tests before implementation
- Verify tests fail for the right reasons
- Implement minimal code to pass tests
- Refactor with confidence

### 2. Edge Case Focus
- Target uncovered branches systematically
- Use coverage reports to identify gaps
- Prioritize error paths and exception handling
- Test boundary conditions thoroughly

### 3. Property-Based Testing
- Use Hypothesis for complex logic
- Generate 100+ scenarios per property
- Test invariants and properties
- Catch edge cases automatically

### 4. Integration Testing
- Add end-to-end workflow tests
- Test component interactions
- Verify system behavior under load
- Test failure recovery paths

### 5. Continuous Validation
- Run coverage after each test file
- Monitor coverage trends
- Validate against milestones
- Document coverage improvements

---

## Test Development Checklist

### Per Module Checklist

For each module being improved:

- [ ] **Review current coverage report**
  - Identify uncovered lines
  - Analyze uncovered branches
  - Note missing error paths

- [ ] **Design test scenarios**
  - List edge cases to cover
  - Identify integration points
  - Plan property tests

- [ ] **Write tests systematically**
  - Start with happy path coverage
  - Add error path tests
  - Add boundary condition tests
  - Add property-based tests

- [ ] **Verify coverage improvement**
  - Run coverage report
  - Confirm target met
  - Document new coverage

- [ ] **Code review**
  - Review test quality
  - Check for test duplication
  - Verify test clarity
  - Validate assertions

---

## Risk Management

### Identified Risks

1. **Risk:** Test suite execution time increases significantly
   - **Mitigation:** Optimize slow tests, use pytest markers for selective runs
   - **Contingency:** Implement parallel test execution

2. **Risk:** Flaky tests introduced with threading tests
   - **Mitigation:** Use proper synchronization primitives, avoid timing dependencies
   - **Contingency:** Isolate flaky tests, mark as conditional

3. **Risk:** Complex CLI testing proves impractical
   - **Mitigation:** Accept 50% target, focus on critical paths
   - **Contingency:** Use integration tests instead of unit tests

4. **Risk:** Coverage improvement reveals bugs
   - **Mitigation:** This is actually good! Fix bugs as discovered
   - **Contingency:** Track bugs separately, prioritize by severity

5. **Risk:** Timeline slips due to unforeseen complexity
   - **Mitigation:** Start with high-priority modules, adjust timeline
   - **Contingency:** Release with Phase 1+2 complete, defer Phase 3+4

---

## Resource Requirements

### Development Time
- **Phase 1:** 10-16 hours (Week 1)
- **Phase 2:** 16-22 hours (Week 2)
- **Phase 3:** 9-13 hours (Week 3)
- **Phase 4:** 8-10 hours (Week 4 - Stretch)
- **Total:** 43-61 hours over 4 weeks

### Infrastructure
- Development environment with Python 3.8+
- pytest, coverage, hypothesis libraries
- Pre-commit hooks configured
- Access to coverage reports and analysis tools

### Documentation
- Update TESTING.md with new patterns
- Update STATUS.md with coverage metrics
- Archive coverage reports in `docs/archive/reviews/v3.6-coverage-report.html`
- Document test scenarios in module docstrings

---

## Metrics & Tracking

### Coverage Metrics to Track

**Per-File Metrics:**
- Statement coverage percentage
- Branch coverage percentage
- Missing line numbers
- Uncovered branch conditions

**Overall Metrics:**
- Total statement coverage
- Total branch coverage
- Test count and pass rate
- Property test scenario count
- Test execution time

**Quality Metrics:**
- Test code quality (pylint score)
- Test clarity and maintainability
- Test duplication ratio
- Assert coverage (assertions per test)

### Tracking Tools

```bash
# Generate detailed coverage report
coverage run -m pytest tests/
coverage html
coverage report --show-missing

# Per-file coverage
coverage report --include="vscode_scanner/cache_manager.py"

# Branch coverage
coverage run --branch -m pytest tests/
coverage report --show-missing

# Combine with test count
pytest tests/ --co -q | wc -l  # Count tests
pytest tests/ -v | grep PASSED | wc -l  # Count passing
```

---

## Documentation Updates

### Files to Update Post-Implementation

1. **STATUS.md**
   - Update coverage metrics
   - Update test count
   - Update milestone status
   - Reference this roadmap

2. **TESTING.md**
   - Document new test patterns
   - Add examples of edge case testing
   - Update coverage targets
   - Document test organization

3. **CHANGELOG.md**
   - Document coverage improvements
   - List new test categories
   - Note bug fixes from testing

4. **Coverage Reports Archive**
   - Create `docs/archive/reviews/v3.6-coverage-report.html`
   - Save detailed per-file coverage analysis
   - Document before/after comparison metrics

---

## Post-Implementation Review

### Success Evaluation Criteria

After completion, evaluate:

1. **Coverage Targets Met?**
   - Were per-file targets achieved?
   - Did overall coverage reach 80%+?
   - Were security modules maintained?

2. **Test Quality Acceptable?**
   - Are tests clear and maintainable?
   - Do tests catch real bugs?
   - Are property tests effective?

3. **Timeline Adherence?**
   - Were milestones met on schedule?
   - Were risks properly mitigated?
   - Were resources adequate?

4. **Lessons Learned?**
   - What worked well?
   - What could be improved?
   - What surprises occurred?

### Continuous Improvement

Based on review:
- Update testing guidelines
- Refine coverage targets
- Improve test tooling
- Share knowledge with team

---

## Appendix A: Test File Organization

### Current Test Structure (46 files)
```
tests/
â”œâ”€â”€ Security Tests (9 files)
â”‚   â”œâ”€â”€ test_security.py
â”‚   â”œâ”€â”€ test_security_regression.py
â”‚   â”œâ”€â”€ test_security_coverage_boost.py
â”‚   â”œâ”€â”€ test_path_validation.py
â”‚   â”œâ”€â”€ test_string_sanitization.py
â”‚   â”œâ”€â”€ test_property_validation.py
â”‚   â”œâ”€â”€ test_cache_integrity.py
â”‚   â”œâ”€â”€ test_property_cache.py
â”‚   â””â”€â”€ test_sqlite_security.py
â”‚
â”œâ”€â”€ Core Module Tests (11 files)
â”‚   â”œâ”€â”€ test_scanner.py
â”‚   â”œâ”€â”€ test_api.py
â”‚   â”œâ”€â”€ test_cli.py
â”‚   â”œâ”€â”€ test_cli_coverage_boost.py
â”‚   â”œâ”€â”€ test_display.py
â”‚   â”œâ”€â”€ test_utils.py
â”‚   â”œâ”€â”€ test_config_manager.py
â”‚   â”œâ”€â”€ test_cache_commands.py
â”‚   â”œâ”€â”€ test_config_commands.py
â”‚   â”œâ”€â”€ test_config_extensions_dir.py
â”‚   â””â”€â”€ test_extension_discovery.py
â”‚
â”œâ”€â”€ Integration Tests (6 files)
â”‚   â”œâ”€â”€ test_integration.py
â”‚   â”œâ”€â”€ test_integration_real_api.py
â”‚   â”œâ”€â”€ test_parallel_scanning.py
â”‚   â”œâ”€â”€ test_workflow_retry.py
â”‚   â”œâ”€â”€ test_retry.py
â”‚   â””â”€â”€ test_retry_analysis.py
â”‚
â”œâ”€â”€ HTML Report Tests (8 files)
â”‚   â”œâ”€â”€ test_html_generator.py
â”‚   â”œâ”€â”€ test_html_base_component.py
â”‚   â”œâ”€â”€ test_html_header.py
â”‚   â”œâ”€â”€ test_html_footer.py
â”‚   â”œâ”€â”€ test_html_charts.py
â”‚   â”œâ”€â”€ test_html_controls.py
â”‚   â”œâ”€â”€ test_html_overview_table.py
â”‚   â””â”€â”€ test_html_detail_view.py
â”‚
â””â”€â”€ Supporting Tests (12 files)
    â”œâ”€â”€ test_architecture.py
    â”œâ”€â”€ test_input_validators.py
    â”œâ”€â”€ test_output_formatter.py
    â”œâ”€â”€ test_report_commands.py
    â”œâ”€â”€ test_report_empty_cache.py
    â”œâ”€â”€ test_error_handling.py
    â”œâ”€â”€ test_transactional_cache.py
    â”œâ”€â”€ test_db_integrity.py
    â”œâ”€â”€ test_performance.py
    â”œâ”€â”€ test_mock_validation.py
    â”œâ”€â”€ test_failed_extensions.py
    â””â”€â”€ test_verbose_mode.py
```

### Proposed New Test Files (v3.6)
```
tests/
â”œâ”€â”€ Phase 1: Security Hardening
â”‚   â”œâ”€â”€ test_cache_error_recovery.py (NEW)
â”‚   â”œâ”€â”€ test_cache_threading.py (NEW)
â”‚   â””â”€â”€ [Enhanced existing security tests]
â”‚
â”œâ”€â”€ Phase 2: Core Logic
â”‚   â”œâ”€â”€ test_scanner_error_recovery.py (NEW)
â”‚   â”œâ”€â”€ test_scanner_filters.py (NEW)
â”‚   â”œâ”€â”€ test_config_validation.py (NEW)
â”‚   â””â”€â”€ [Enhanced existing core tests]
â”‚
â”œâ”€â”€ Phase 3: Infrastructure
â”‚   â”œâ”€â”€ test_extension_discovery_edge_cases.py (NEW)
â”‚   â”œâ”€â”€ test_output_edge_cases.py (NEW)
â”‚   â””â”€â”€ [Enhanced existing infrastructure tests]
â”‚
â””â”€â”€ Phase 4: CLI Enhancement
    â”œâ”€â”€ test_cli_integration.py (NEW)
    â””â”€â”€ [Enhanced existing CLI tests]
```

---

## Appendix B: Coverage Commands Reference

### Essential Coverage Commands

```bash
# Run tests with coverage
coverage run -m pytest tests/

# Generate HTML report
coverage html
open htmlcov/index.html

# Terminal report with missing lines
coverage report --show-missing

# Per-file coverage
coverage report --include="vscode_scanner/cache_manager.py" --show-missing

# Branch coverage
coverage run --branch -m pytest tests/
coverage report

# Check against threshold
coverage report --fail-under=75

# Combine coverage from parallel runs
coverage combine
coverage report

# Erase previous coverage data
coverage erase

# Generate XML report (for CI/CD)
coverage xml
```

### Useful Pytest Commands

```bash
# Run specific test file
pytest tests/test_cache_manager.py -v

# Run tests matching pattern
pytest tests/ -k "cache" -v

# Run tests with markers
pytest tests/ -m security -v

# Show test collection
pytest tests/ --co -q

# Run with coverage inline
pytest tests/ --cov=vscode_scanner --cov-report=html

# Run failed tests only
pytest tests/ --lf

# Run tests in parallel (if installed pytest-xdist)
pytest tests/ -n auto

# Stop on first failure
pytest tests/ -x

# Verbose with captured output
pytest tests/ -v -s
```

---

## Appendix C: Example Test Patterns

### Pattern 1: Error Path Testing

```python
def test_cache_manager_handles_disk_full_error():
    """Test cache handles disk full error gracefully."""
    # Arrange
    cache = CacheManager()

    # Simulate disk full
    with patch('sqlite3.connect') as mock_connect:
        mock_connect.side_effect = sqlite3.OperationalError("disk I/O error")

        # Act & Assert
        with pytest.raises(CacheError) as exc_info:
            cache.store("test-ext", "1.0.0", {"score": 50})

        assert "disk" in str(exc_info.value).lower()
```

### Pattern 2: Edge Case Testing

```python
@pytest.mark.parametrize("duration,expected", [
    (0, "0s"),
    (0.001, "0s"),  # rounds to 0
    (-1, "0s"),  # negative handled
    (59, "59s"),
    (60, "1m 0s"),
    (3661, "1h 1m 1s"),
    (float('inf'), "unknown"),  # infinity handled
])
def test_format_duration_edge_cases(duration, expected):
    """Test format_duration handles edge cases."""
    assert format_duration(duration) == expected
```

### Pattern 3: Property-Based Testing

```python
from hypothesis import given, strategies as st

@given(st.text())
def test_sanitize_string_never_produces_dangerous_output(text):
    """Property: sanitized string never contains dangerous patterns."""
    sanitized = sanitize_string(text, context="output")

    # Properties that must hold
    assert "../" not in sanitized
    assert "~/" not in sanitized
    assert len(sanitized) <= len(text)
```

---

**Document Status:** Active Roadmap
**Next Review:** After each milestone completion
**Owned By:** Development Team
**Last Updated:** 2025-11-02
