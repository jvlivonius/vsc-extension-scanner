# v3.6 Coverage Improvement Test Case Checklist

**Document Type:** Implementation Tracking
**Target Release:** v3.6.0
**Created:** 2025-11-02
**Status:** Planning
**Parent Document:** [v3.6 Coverage Roadmap](v3.6-coverage-improvement-roadmap.md)

---

## How to Use This Checklist

1. **Mark completed items** with âœ…
2. **Track in-progress items** with ðŸ”„
3. **Note blockers** with âŒ and add comments
4. **Update coverage numbers** as you progress
5. **Commit checklist updates** with each milestone

---

## Phase 1: Security Module Hardening

### cache_manager.py (60.54% â†’ 75%)

**Current:** 508 statements, 194 missing (60.54%)
**Target:** 381 statements covered (75%)
**Progress:** [ ] 0/70 tests added

#### Error Recovery Tests (30 tests)

**Database Errors:**
- [ ] Database corruption detection
- [ ] Database corruption recovery
- [ ] Disk full during write
- [ ] Disk full during transaction
- [ ] SQLite lock timeout (busy database)
- [ ] Concurrent access conflicts
- [ ] Transaction rollback on error
- [ ] Transaction commit failure
- [ ] Connection failure handling
- [ ] Database file permission denied

**File Operation Errors:**
- [ ] Cache directory creation failure
- [ ] Cache file deletion failure
- [ ] Temp file creation failure
- [ ] Atomic rename failure
- [ ] File lock acquisition failure

**Integrity Errors:**
- [ ] HMAC signature mismatch
- [ ] Corrupted entry data
- [ ] Missing required fields
- [ ] Invalid timestamp format
- [ ] Schema version mismatch

**Recovery Workflows:**
- [ ] Automatic cache rebuild on corruption
- [ ] Graceful degradation (skip corrupted entries)
- [ ] Error logging and reporting
- [ ] Transaction retry logic
- [ ] Safe mode operation (read-only)

#### Threading Tests (20 tests)

**Race Conditions:**
- [ ] Concurrent cache reads (same extension)
- [ ] Concurrent cache writes (different extensions)
- [ ] Concurrent cache reads/writes (mixed)
- [ ] Race condition in cache hit counter
- [ ] Race condition in cache miss counter

**Thread Safety:**
- [ ] ThreadSafeStats increment operations
- [ ] ThreadSafeStats read operations
- [ ] Lock acquisition timeout
- [ ] Deadlock prevention
- [ ] Worker thread crash handling

**Parallel Operations:**
- [ ] Multiple workers reading cache
- [ ] Multiple workers writing cache
- [ ] Main thread writes during worker reads
- [ ] Cache stats collection during parallel scans
- [ ] Database connection pooling

#### Batch Operations (10 tests)

**Batch Insert:**
- [ ] Batch insert success (all records)
- [ ] Batch insert partial failure
- [ ] Batch insert rollback on error
- [ ] Large batch size (>1000 records)
- [ ] Empty batch handling

**Batch Operations:**
- [ ] Batch update operations
- [ ] Batch delete operations
- [ ] Batch operation atomicity
- [ ] Batch operation cancellation
- [ ] Batch operation progress tracking

#### Migration and Integrity (10 tests)

**Schema Migration:**
- [ ] Migration from v1 to v2 schema
- [ ] Migration with data transformation
- [ ] Migration rollback on error
- [ ] Migration with large dataset

**Integrity Checks:**
- [ ] HMAC verification on all reads
- [ ] HMAC update on writes
- [ ] Data corruption detection
- [ ] Legacy cache format handling
- [ ] Cache validation on startup
- [ ] Periodic integrity checks

**Test Files:**
- [ ] Create `tests/test_cache_error_recovery.py`
- [ ] Create `tests/test_cache_threading.py`
- [ ] Enhance `tests/test_cache_integrity.py`
- [ ] Enhance `tests/test_transactional_cache.py`

**Coverage Check:** [ ] cache_manager.py â‰¥ 75%

---

### utils.py (64.50% â†’ 75%)

**Current:** 192 statements, 63 missing (64.50%)
**Target:** 144 statements covered (75%)
**Progress:** [ ] 0/40 tests added
**Note:** Security functions already at 95%+

#### Utility Function Tests (20 tests)

**format_duration():**
- [ ] Zero duration (0s)
- [ ] Negative duration (handled as 0)
- [ ] Fractional seconds (<1s)
- [ ] Exact minutes (60s â†’ 1m 0s)
- [ ] Hours + minutes + seconds
- [ ] Very large duration (>24h)
- [ ] Infinity handling
- [ ] NaN handling

**truncate_text():**
- [ ] Empty string
- [ ] String shorter than max_length
- [ ] String exactly at max_length
- [ ] String longer than max_length
- [ ] Unicode characters (multi-byte)
- [ ] Emoji truncation
- [ ] Combining characters
- [ ] Zero-width characters

**get_terminal_width():**
- [ ] Standard terminal width
- [ ] Very narrow terminal (<40 cols)
- [ ] Very wide terminal (>200 cols)
- [ ] Terminal width detection failure (fallback)

**ensure_parent_dir():**
- [ ] Parent directory already exists
- [ ] Parent directory needs creation
- [ ] Multiple levels of directories
- [ ] Permission denied on parent creation

#### Error Formatting Tests (10 tests)

**Error Message Handling:**
- [ ] Simple error message
- [ ] Multi-line error message
- [ ] Very long error message (>1000 chars)
- [ ] Error message with unicode
- [ ] Error message with special characters
- [ ] Empty error message
- [ ] None error message

**Error Context:**
- [ ] Error with context extraction
- [ ] Error without context
- [ ] Error context truncation

#### Path Utility Tests (5 tests)

**Platform-Specific:**
- [ ] UNC path handling (Windows)
- [ ] Network drive detection
- [ ] Case sensitivity (macOS vs Linux)
- [ ] Path normalization edge cases
- [ ] Symlink resolution

#### String Processing Tests (5 tests)

**Advanced String Handling:**
- [ ] Multi-byte character processing
- [ ] Emoji in strings
- [ ] RTL (right-to-left) text
- [ ] Very long strings (>10KB)
- [ ] Empty string edge cases

**Test Files:**
- [ ] Enhance `tests/test_utils.py` (40 â†’ 80 tests)
- [ ] Add property tests to `tests/test_property_validation.py`

**Coverage Check:** [ ] utils.py â‰¥ 75%

---

## Phase 2: Core Business Logic

### scanner.py (60.29% â†’ 75%)

**Current:** 565 statements, 199 missing (60.29%)
**Target:** 424 statements covered (75%)
**Progress:** [ ] 0/80 tests added

#### Error Recovery Workflows (30 tests)

**Individual Extension Failures:**
- [ ] Single extension scan failure (continues)
- [ ] Multiple extension failures (continues)
- [ ] Extension not found (graceful skip)
- [ ] Invalid extension metadata
- [ ] Extension parsing error

**API Errors:**
- [ ] API timeout (retry exhausted)
- [ ] API rate limit exceeded
- [ ] API returns invalid JSON
- [ ] API returns error response
- [ ] Network disconnection mid-scan

**Cache Errors:**
- [ ] Cache write failure (continues)
- [ ] Cache read failure (fallback to API)
- [ ] Cache corruption (skip entry)
- [ ] Cache unavailable (API mode)

**Partial Results:**
- [ ] Some extensions succeed, some fail
- [ ] All extensions fail (report failure)
- [ ] Mix of cached and fresh results
- [ ] Failed extension tracking accuracy

**Recovery Paths:**
- [ ] Retry logic integration
- [ ] Fallback to cached data
- [ ] Graceful degradation
- [ ] Error aggregation and reporting

#### Complex Filter Combinations (20 tests)

**Single Filters:**
- [ ] Publisher filter only
- [ ] Risk level filter only
- [ ] Verified filter only
- [ ] Vulnerability filter only
- [ ] Include IDs filter only
- [ ] Exclude IDs filter only

**Combined Filters:**
- [ ] Publisher + risk level
- [ ] Publisher + verified
- [ ] Risk level + vulnerabilities
- [ ] Verified + risk level
- [ ] Include + exclude IDs (conflict)
- [ ] All filters combined
- [ ] Empty result set handling
- [ ] Filter validation errors

**Edge Cases:**
- [ ] Filter with no matching extensions
- [ ] Filter with all extensions matching
- [ ] Case-insensitive publisher matching
- [ ] Wildcard in include/exclude IDs

#### Thread Synchronization (15 tests)

**Worker Threads:**
- [ ] Worker thread creation
- [ ] Worker thread failure (continue)
- [ ] Worker thread crash (handled)
- [ ] Worker thread timeout
- [ ] Worker thread clean shutdown

**Stats Collection:**
- [ ] Thread-safe increment operations
- [ ] Concurrent stats updates
- [ ] Stats race condition prevention
- [ ] Final stats aggregation accuracy

**Shared Resources:**
- [ ] Cache manager shared access
- [ ] API client per-worker isolation
- [ ] Progress tracker thread safety
- [ ] Results collection atomicity

**Thread Pool:**
- [ ] Thread pool creation
- [ ] Thread pool exhaustion
- [ ] Thread pool shutdown

#### Partial Failure Scenarios (10 tests)

**Mixed Success/Failure:**
- [ ] 50% success, 50% failure
- [ ] Cached results + API failures
- [ ] New scans + cache hits
- [ ] Failed extension list accuracy

**Interrupted Scans:**
- [ ] User cancellation (Ctrl+C)
- [ ] Timeout mid-scan
- [ ] Resource exhaustion mid-scan
- [ ] Resume capability verification

**Reporting:**
- [ ] Failed extension table display
- [ ] Error categorization accuracy
- [ ] Actionable error suggestions
- [ ] JSON failed_extensions array

#### Signal Handling (5 tests)

**Graceful Shutdown:**
- [ ] SIGINT handling (Ctrl+C)
- [ ] SIGTERM handling
- [ ] Cleanup on termination
- [ ] Partial results saved
- [ ] Thread cleanup verification

**Test Files:**
- [ ] Enhance `tests/test_scanner.py`
- [ ] Enhance `tests/test_parallel_scanning.py`
- [ ] Create `tests/test_scanner_error_recovery.py`
- [ ] Create `tests/test_scanner_filters.py`

**Coverage Check:** [ ] scanner.py â‰¥ 75%

---

### config_manager.py (57.48% â†’ 75%)

**Current:** 146 statements, 56 missing (57.48%)
**Target:** 110 statements covered (75%)
**Progress:** [ ] 0/50 tests added

#### Validation Error Paths (20 tests)

**Type Validation:**
- [ ] Invalid integer (non-numeric string)
- [ ] Invalid float (non-numeric string)
- [ ] Invalid boolean (invalid value)
- [ ] Invalid choice (not in allowed list)
- [ ] Invalid path (non-existent)

**Range Validation:**
- [ ] Integer out of min-max range
- [ ] Float out of min-max range
- [ ] Negative value when positive required
- [ ] Zero when non-zero required

**Coercion Errors:**
- [ ] String to int coercion failure
- [ ] String to float coercion failure
- [ ] String to bool coercion ambiguity
- [ ] Path expansion failure

**Empty Values:**
- [ ] Empty string for required field
- [ ] None value for required field
- [ ] Whitespace-only values

**Multiple Errors:**
- [ ] Multiple validation errors at once
- [ ] Error message aggregation

#### File Operation Errors (15 tests)

**Read Errors:**
- [ ] Config file not found (create default)
- [ ] Permission denied on read
- [ ] Corrupted config file
- [ ] Very large config file (>1MB)

**Write Errors:**
- [ ] Permission denied on write
- [ ] Disk full during write
- [ ] Directory doesn't exist
- [ ] Atomic write failure
- [ ] Temp file creation failure

**Concurrent Access:**
- [ ] Multiple processes reading
- [ ] Multiple processes writing
- [ ] Read while writing (race condition)
- [ ] File lock handling

#### Malformed Configuration (10 tests)

**Syntax Errors:**
- [ ] Invalid INI syntax
- [ ] Missing section headers
- [ ] Duplicate keys in section
- [ ] Unclosed quotes

**Encoding Errors:**
- [ ] Non-UTF-8 encoding
- [ ] Unicode decode errors
- [ ] Byte order mark (BOM) handling

**Structure Errors:**
- [ ] Missing required sections
- [ ] Unknown sections (ignored)
- [ ] Empty config file

#### Type Coercion Edge Cases (5 tests)

**Boolean Parsing:**
- [ ] "yes" â†’ True
- [ ] "no" â†’ False
- [ ] "1" â†’ True
- [ ] "0" â†’ False
- [ ] "true" â†’ True (case-insensitive)

**Path Expansion:**
- [ ] ~ (home directory) expansion
- [ ] Environment variable expansion
- [ ] Relative path handling
- [ ] Absolute path preservation

**Test Files:**
- [ ] Enhance `tests/test_config_manager.py`
- [ ] Create `tests/test_config_validation.py`
- [ ] Enhance `tests/test_config_commands.py`

**Coverage Check:** [ ] config_manager.py â‰¥ 75%

---

## Phase 3: Infrastructure Layer

### extension_discovery.py (63.98% â†’ 75%)

**Current:** 155 statements, 53 missing (63.98%)
**Target:** 116 statements covered (75%)
**Progress:** [ ] 0/40 tests added

#### Symlink Handling (15 tests)

**Symlink Types:**
- [ ] Valid symlink to extension
- [ ] Broken symlink (target missing)
- [ ] Circular symlink (A â†’ B â†’ A)
- [ ] Symlink chain (A â†’ B â†’ C)
- [ ] External symlink (outside extensions dir)

**Permissions:**
- [ ] Permission denied on symlink target
- [ ] Read-only symlink target
- [ ] Executable permission on symlink

**Edge Cases:**
- [ ] Symlink to non-extension directory
- [ ] Symlink to file instead of directory
- [ ] Very deep symlink chains (>10 levels)
- [ ] Symlink with unicode name
- [ ] Relative vs absolute symlinks

#### Permission Errors (10 tests)

**Directory Permissions:**
- [ ] Read permission denied (extension dir)
- [ ] Execute permission denied (extension dir)
- [ ] Permission denied on subdirectory
- [ ] Mixed permissions across extensions

**File Permissions:**
- [ ] Read permission denied (package.json)
- [ ] Write permission on read (should succeed)
- [ ] No permissions at all

**Recovery:**
- [ ] Skip inaccessible extension (continue)
- [ ] Log permission errors
- [ ] Graceful degradation

#### Malformed package.json (10 tests)

**JSON Syntax:**
- [ ] Invalid JSON syntax
- [ ] Truncated JSON file
- [ ] Empty file
- [ ] Binary data instead of JSON

**Required Fields:**
- [ ] Missing "name" field
- [ ] Missing "version" field
- [ ] Missing "publisher" field
- [ ] Missing all required fields

**Invalid Types:**
- [ ] "version" is not a string
- [ ] "name" is not a string
- [ ] Null values for required fields

**Large Files:**
- [ ] Very large package.json (>1MB)

#### Large Directory Handling (5 tests)

**Scalability:**
- [ ] >1000 extensions in directory
- [ ] Deep directory nesting (>10 levels)
- [ ] Very long file paths (>260 chars Windows)
- [ ] Unicode in directory names
- [ ] Mixed case sensitivity handling

**Test Files:**
- [ ] Enhance `tests/test_extension_discovery.py`
- [ ] Create `tests/test_extension_discovery_edge_cases.py`

**Coverage Check:** [ ] extension_discovery.py â‰¥ 75%

---

### output_formatter.py (62.30% â†’ 75%)

**Current:** 102 statements, 42 missing (62.30%)
**Target:** 77 statements covered (75%)
**Progress:** [ ] 0/35 tests added

#### CSV Edge Cases (15 tests)

**Special Characters:**
- [ ] Commas in field values
- [ ] Quotes in field values
- [ ] Newlines in field values
- [ ] Tabs in field values
- [ ] Mixed special characters

**Large Fields:**
- [ ] Field value >10KB
- [ ] Field value >100KB
- [ ] Very long vulnerability lists

**Encoding:**
- [ ] Unicode characters in CSV
- [ ] Emoji in extension names
- [ ] Non-ASCII publisher names

**Security:**
- [ ] CSV injection prevention (=, +, -, @)
- [ ] Formula injection prevention

**Edge Cases:**
- [ ] Empty field values
- [ ] Null/None field values
- [ ] Missing optional fields

#### JSON Unicode Handling (10 tests)

**Character Types:**
- [ ] Emoji in extension names
- [ ] Chinese/Japanese/Korean characters
- [ ] Arabic/Hebrew (RTL) text
- [ ] Combining characters
- [ ] Zero-width characters

**Encoding:**
- [ ] UTF-8 encoding verification
- [ ] Unicode escape sequences
- [ ] Surrogate pairs
- [ ] Invalid unicode handling

**Edge Cases:**
- [ ] Mixed scripts (Latin + Arabic)
- [ ] Very long unicode strings

#### Large Dataset Handling (5 tests)

**Scalability:**
- [ ] >1000 extensions export
- [ ] >10,000 extension export
- [ ] Memory efficiency validation
- [ ] Streaming write capability

**Performance:**
- [ ] Export time acceptable (<10s for 1000)

#### File Write Errors (5 tests)

**Write Failures:**
- [ ] Disk full during write
- [ ] Permission denied on output file
- [ ] Invalid output path
- [ ] Output directory doesn't exist
- [ ] Filename with invalid characters

**Test Files:**
- [ ] Enhance `tests/test_output_formatter.py`
- [ ] Create `tests/test_output_edge_cases.py`

**Coverage Check:** [ ] output_formatter.py â‰¥ 75%

---

## Phase 4: CLI Enhancement (Stretch Goal)

### cli.py (17.55% â†’ 50%)

**Current:** 564 statements, 455 missing (17.55%)
**Target:** 282 statements covered (50%)
**Progress:** [ ] 0/60 tests added
**Note:** Revised target due to Typer framework complexity

#### Command Integration Tests (25 tests)

**Scan Command:**
- [ ] Basic scan (no arguments)
- [ ] Scan with --output JSON
- [ ] Scan with --output HTML
- [ ] Scan with --output CSV
- [ ] Scan with --quiet
- [ ] Scan with --verbose
- [ ] Scan with --plain
- [ ] Scan with --no-cache
- [ ] Scan with --refresh-cache
- [ ] Scan with --extensions-dir
- [ ] Scan with --workers
- [ ] Scan with --delay

**Config Commands:**
- [ ] config init
- [ ] config show
- [ ] config set <key> <value>
- [ ] config get <key>
- [ ] config reset

**Cache Commands:**
- [ ] cache stats
- [ ] cache clear (with confirmation)
- [ ] cache clear --force

**Report Commands:**
- [ ] report <output.json>
- [ ] report <output.html>
- [ ] report <output.csv>

**Flag Combinations:**
- [ ] Multiple output formats
- [ ] Conflicting options

#### Argument Validation (15 tests)

**Invalid Types:**
- [ ] --workers with non-integer
- [ ] --delay with non-float
- [ ] --output with invalid extension

**Out of Range:**
- [ ] --workers < 1
- [ ] --workers > 5
- [ ] --delay < 0.5
- [ ] --delay > 10.0

**Missing Required:**
- [ ] config set without key
- [ ] config set without value
- [ ] report without output file

**Invalid Paths:**
- [ ] --extensions-dir non-existent
- [ ] --output to read-only directory

**Multiple Errors:**
- [ ] Multiple validation errors at once

#### Interactive Prompts (10 tests)

**Confirmations:**
- [ ] cache clear confirmation (yes)
- [ ] cache clear confirmation (no)
- [ ] config reset confirmation (yes)
- [ ] config reset confirmation (no)

**Input Validation:**
- [ ] Invalid yes/no response
- [ ] Empty response
- [ ] Case-insensitive yes/no
- [ ] Keyboard interrupt (Ctrl+C)

**User Input:**
- [ ] Prompt timeout
- [ ] Non-interactive mode

#### Exit Code Verification (10 tests)

**Success Cases:**
- [ ] Exit 0: Success, no vulnerabilities
- [ ] Exit 1: Success, vulnerabilities found

**Error Cases:**
- [ ] Exit 2: Scan failed (API error)
- [ ] Exit 2: Scan failed (no extensions)
- [ ] Exit 2: Scan failed (invalid config)
- [ ] Exit 2: Permission denied
- [ ] Exit 2: Disk full
- [ ] Exit 2: Network error

**Special Cases:**
- [ ] Exit on SIGINT (Ctrl+C)
- [ ] Exit on unhandled exception

**Test Files:**
- [ ] Enhance `tests/test_cli.py`
- [ ] Enhance `tests/test_cli_coverage_boost.py`
- [ ] Create `tests/test_cli_integration.py`

**Coverage Check:** [ ] cli.py â‰¥ 50%

---

## Milestone Tracking

### Milestone 1: Security Excellence (Week 1)

**Target Coverage:**
- [ ] cache_manager.py: 75%+
- [ ] utils.py: 75%+
- [ ] Overall: ~74%

**Tests Added:**
- [ ] 70 cache_manager tests
- [ ] 40 utils tests
- [ ] Total: 110 tests

**Completion:** [ ] Phase 1 complete

---

### Milestone 2: Core Logic (Week 2)

**Target Coverage:**
- [ ] scanner.py: 75%+
- [ ] config_manager.py: 75%+
- [ ] Overall: ~77%

**Tests Added:**
- [ ] 80 scanner tests
- [ ] 50 config_manager tests
- [ ] Total: 240 tests (cumulative)

**Completion:** [ ] Phase 2 complete

---

### Milestone 3: Infrastructure (Week 3)

**Target Coverage:**
- [ ] extension_discovery.py: 75%+
- [ ] output_formatter.py: 75%+
- [ ] Overall: 80%+

**Tests Added:**
- [ ] 40 extension_discovery tests
- [ ] 35 output_formatter tests
- [ ] Total: 315 tests (cumulative)

**Completion:** [ ] Phase 3 complete

---

### Milestone 4: CLI Enhancement (Week 4 - Stretch)

**Target Coverage:**
- [ ] cli.py: 50%+
- [ ] Overall: 82%+

**Tests Added:**
- [ ] 60 cli tests
- [ ] Total: 375 tests (cumulative)

**Completion:** [ ] Phase 4 complete

---

## Final Validation

### Coverage Verification

- [ ] Overall coverage: â‰¥ 80%
- [ ] Branch coverage: â‰¥ 85%
- [ ] Security coverage: â‰¥ 95% (maintained)
- [ ] All target modules: â‰¥ 75% (except CLI: â‰¥ 50%)

### Test Suite Health

- [ ] Total tests: â‰¥ 1,000
- [ ] Test pass rate: 100%
- [ ] No flaky tests
- [ ] Test execution time: < 60 seconds
- [ ] All tests documented

### Documentation

- [ ] STATUS.md updated with final metrics
- [ ] TESTING.md updated with new patterns
- [ ] Coverage report archived
- [ ] CHANGELOG.md updated

### Release Readiness

- [ ] All milestones complete
- [ ] All tests passing
- [ ] Documentation complete
- [ ] Coverage targets met
- [ ] Ready for v3.6.0 release

---

**Checklist Status:** [ ] Not Started | [ ] In Progress | [ ] Complete
**Last Updated:** 2025-11-02
**Next Review:** After each milestone completion
